"use strict";angular.module("root-multi-select",["ng"]).directive("rootMultiSelect",["$sce","$timeout","$templateCache",function(a,b,c){return{restrict:"AE",scope:{inputModel:"=",outputModel:"=",isDisabled:"=",onClear:"&",onClose:"&",onSearchChange:"&",onItemClick:"&",onOpen:"&",onReset:"&",onSelectAll:"&",onSelectNone:"&",translation:"="},templateUrl:"root-multi-select.htm",link:function(c,d,e){function o(a){for(var b="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",c="",d=0;d<a;d++)c+=b.charAt(Math.floor(Math.random()*b.length));return c}c.backUp=[],c.varButtonLabel="",c.spacingProperty="",c.indexProperty="",c.orientationH=!1,c.orientationV=!0,c.filteredModel=[],c.inputLabel={labelFilter:""},c.tabIndex=0,c.lang={},c.helperStatus={all:!0,none:!0,reset:!0,filter:!0};var f=0,g=[],h=0,i="",l=[],m=0,n=null;c.clearClicked=function(a){c.inputLabel.labelFilter="",c.updateFilter(),c.select("clear",a)},c.numberToArray=function(a){return new Array(a)},c.searchChanged=function(){return!(c.inputLabel.labelFilter.length<m&&c.inputLabel.labelFilter.length>0)&&void c.updateFilter()},c.replaceutf8=function(a){var b=a.toString().toLowerCase();return b},c.updateFilter=function(){c.filteredModel=[];var a=0;if("undefined"==typeof c.inputModel)return!1;for(a=c.inputModel.length-1;a>=0;a--){"undefined"!=typeof c.inputModel[a][e.groupProperty]&&c.inputModel[a][e.groupProperty]===!1&&c.filteredModel.push(c.inputModel[a]);var d=!1;if("undefined"==typeof c.inputModel[a][e.groupProperty]){if("undefined"!=typeof e.searchProperty&&""!==e.searchProperty){for(var f in c.inputModel[a])if("object"==typeof c.inputModel[a][f]){var g=c.inputModel[a][f],h=e.searchProperty.split(".");if(String(h[0]).toUpperCase()==f.toUpperCase()&&String(g[h[1]]).toUpperCase().indexOf(c.inputLabel.labelFilter.toUpperCase())>=0){d=!0;break}}else if("boolean"!=typeof c.inputModel[a][f]&&String(c.replaceutf8(c.inputModel[a][f])).toUpperCase().indexOf(c.replaceutf8(c.inputLabel.labelFilter).toUpperCase())>=0&&e.searchProperty.indexOf(f)>-1){d=!0;break}}else for(var f in c.inputModel[a])if("boolean"!=typeof c.inputModel[a][f]&&String(c.inputModel[a][f]).toUpperCase().indexOf(c.inputLabel.labelFilter.toUpperCase())>=0){d=!0;break}d===!0&&c.filteredModel.push(c.inputModel[a])}"undefined"!=typeof c.inputModel[a][e.groupProperty]&&c.inputModel[a][e.groupProperty]===!0&&("undefined"!=typeof c.filteredModel[c.filteredModel.length-1][e.groupProperty]&&c.filteredModel[c.filteredModel.length-1][e.groupProperty]===!1?c.filteredModel.pop():c.filteredModel.push(c.inputModel[a]))}c.filteredModel.reverse(),b(function(){if(c.getFormElements(),c.inputLabel.labelFilter.length>m){var a=[];angular.forEach(c.filteredModel,function(b,d){if("undefined"!=typeof b&&"undefined"==typeof b[e.groupProperty]){var f=angular.copy(b),g=a.push(f);delete a[g-1][c.indexProperty],delete a[g-1][c.spacingProperty]}}),c.onSearchChange({data:{keyword:c.inputLabel.labelFilter,result:a}})}},0)},c.getFormElements=function(){l=[];var a=[],b=[],e=[],f=[];c.helperStatus.all||c.helperStatus.none||c.helperStatus.reset?(a=d.children().children().next().children().children()[0].getElementsByTagName("button"),c.helperStatus.filter&&(b=d.children().children().next().children().children().next()[0].getElementsByTagName("input"),f=d.children().children().next().children().children().next()[0].getElementsByTagName("button"))):c.helperStatus.filter&&(b=d.children().children().next().children().children()[0].getElementsByTagName("input"),f=d.children().children().next().children().children()[0].getElementsByTagName("button")),e=c.helperStatus.all||c.helperStatus.none||c.helperStatus.reset||c.helperStatus.filter?d.children().children().next().children().next()[0].getElementsByTagName("input"):d.children().children().next()[0].getElementsByTagName("input");for(var g=0;g<a.length;g++)l.push(a[g]);for(var g=0;g<b.length;g++)l.push(b[g]);for(var g=0;g<f.length;g++)l.push(f[g]);for(var g=0;g<e.length;g++)l.push(e[g])},c.isGroupMarker=function(a,b){return"undefined"!=typeof a[e.groupProperty]&&a[e.groupProperty]===b},c.removeGroupEndMarker=function(a){return"undefined"==typeof a[e.groupProperty]||a[e.groupProperty]!==!1},c.syncItems=function(a,d,g){if(d.preventDefault(),d.stopPropagation(),"undefined"!=typeof e.disableProperty&&a[e.disableProperty]===!0)return!1;if("undefined"!=typeof e.isDisabled&&c.isDisabled===!0)return!1;if("undefined"!=typeof a[e.groupProperty]&&a[e.groupProperty]===!1)return!1;var i=c.filteredModel.indexOf(a);if("undefined"!=typeof a[e.groupProperty]&&a[e.groupProperty]===!0){if("undefined"!=typeof e.selectionMode&&"SINGLE"===e.selectionMode.toUpperCase())return!1;var j,k,m=0,o=c.filteredModel.length-1,p=[],q=0;for(j=i;j<c.filteredModel.length&&!(0===q&&j>i);j++)if("undefined"!=typeof c.filteredModel[j][e.groupProperty]&&c.filteredModel[j][e.groupProperty]===!0)0===p.length&&(m=j+1),q+=1;else if("undefined"!=typeof c.filteredModel[j][e.groupProperty]&&c.filteredModel[j][e.groupProperty]===!1){if(q-=1,p.length>0&&0===q){var r=!0;for(o=j,k=0;k<p.length;k++)if("undefined"!=typeof p[k][c.tickProperty]&&p[k][c.tickProperty]===!1){r=!1;break}if(r===!0)for(k=m;k<=o;k++)"undefined"==typeof c.filteredModel[k][e.groupProperty]&&("undefined"==typeof e.disableProperty?(c.filteredModel[k][c.tickProperty]=!1,s=c.filteredModel[k][c.indexProperty],c.inputModel[s][c.tickProperty]=!1):c.filteredModel[k][e.disableProperty]!==!0&&(c.filteredModel[k][c.tickProperty]=!1,s=c.filteredModel[k][c.indexProperty],c.inputModel[s][c.tickProperty]=!1));else for(k=m;k<=o;k++)"undefined"==typeof c.filteredModel[k][e.groupProperty]&&("undefined"==typeof e.disableProperty?(c.filteredModel[k][c.tickProperty]=!0,s=c.filteredModel[k][c.indexProperty],c.inputModel[s][c.tickProperty]=!0):c.filteredModel[k][e.disableProperty]!==!0&&(c.filteredModel[k][c.tickProperty]=!0,s=c.filteredModel[k][c.indexProperty],c.inputModel[s][c.tickProperty]=!0))}}else p.push(c.filteredModel[j])}else{if("undefined"!=typeof e.selectionMode&&"SINGLE"===e.selectionMode.toUpperCase()){for(j=0;j<c.filteredModel.length;j++)c.filteredModel[j][c.tickProperty]=!1;for(j=0;j<c.inputModel.length;j++)c.inputModel[j][c.tickProperty]=!1;c.filteredModel[i][c.tickProperty]=!0}else c.filteredModel[i][c.tickProperty]=!c.filteredModel[i][c.tickProperty];var s=c.filteredModel[i][c.indexProperty];c.inputModel[s][c.tickProperty]=c.filteredModel[i][c.tickProperty]}n=angular.copy(a),null!==n&&b(function(){delete n[c.indexProperty],delete n[c.spacingProperty],c.onItemClick({data:n}),n=null},0),c.refreshOutputModel(),c.refreshButton(),f=c.tabIndex,c.tabIndex=g+h,d.target.focus(),c.removeFocusStyle(f),c.setFocusStyle(c.tabIndex),"undefined"!=typeof e.selectionMode&&"SINGLE"===e.selectionMode.toUpperCase()&&c.toggleCheckboxes(d)},c.refreshOutputModel=function(){c.outputModel=[];var a=[],b={};"undefined"!=typeof e.outputProperties?(a=e.outputProperties.split(" "),angular.forEach(c.inputModel,function(d,f){if("undefined"!=typeof d&&"undefined"==typeof d[e.groupProperty]&&d[c.tickProperty]===!0){b={},angular.forEach(d,function(c,d){a.indexOf(d)>-1&&(b[d]=c)});var g=c.outputModel.push(b);delete c.outputModel[g-1][c.indexProperty],delete c.outputModel[g-1][c.spacingProperty]}})):angular.forEach(c.inputModel,function(a,b){if("undefined"!=typeof a&&"undefined"==typeof a[e.groupProperty]&&a[c.tickProperty]===!0){var d=angular.copy(a),f=c.outputModel.push(d);delete c.outputModel[f-1][c.indexProperty],delete c.outputModel[f-1][c.spacingProperty]}})},c.refreshButton=function(){c.varButtonLabel="";var b=0;if(0===c.outputModel.length)c.varButtonLabel=c.lang.nothingSelected;else{var d=c.outputModel.length;"undefined"!=typeof e.maxLabels&&""!==e.maxLabels&&(d=e.maxLabels),c.outputModel.length>d?c.more=!0:c.more=!1,angular.forEach(c.inputModel,function(a,f){"undefined"!=typeof a&&a[e.tickProperty]===!0&&(b<d&&(c.varButtonLabel+=(c.varButtonLabel.length>0?'</div>, <div class="buttonLabel">':'<div class="buttonLabel">')+c.writeLabel(a,"buttonLabel")),b++)}),c.more===!0&&(d>0&&(c.varButtonLabel+=", ... "),c.varButtonLabel+="("+c.outputModel.length+")")}c.varButtonLabel=a.trustAsHtml(c.varButtonLabel+'<span class="caret"></span>')},c.itemIsDisabled=function(a){return"undefined"!=typeof e.disableProperty&&a[e.disableProperty]===!0||c.isDisabled===!0},c.writeLabel=function(b,c){var d=e[c].split(" "),f="";return angular.forEach(d,function(a,c){var d=b,e=a.split(".");angular.forEach(e,function(a,b){d=d[a]}),d&&(f+="&nbsp;"+a.split().reduce(function(a,b){var c=a,d=b.split(".");return angular.forEach(d,function(a,b){c=c[a]}),c},b))}),"BUTTONLABEL"===c.toUpperCase()?f:a.trustAsHtml(f)},c.toggleCheckboxes=function(a){var e=d.children()[0];if(angular.element(document).off("click",c.externalClickListener),angular.element(document).off("keydown",c.keyboardListener),angular.element(i).hasClass("show"))angular.element(i).removeClass("show"),angular.element(e).removeClass("buttonClicked"),angular.element(document).off("click",c.externalClickListener),angular.element(document).off("keydown",c.keyboardListener),c.removeFocusStyle(c.tabIndex),"undefined"!=typeof l[c.tabIndex]&&l[c.tabIndex].blur(),b(function(){c.onClose()},0),d.children().children()[0].focus();else{c.inputLabel.labelFilter="",c.updateFilter(),g=[],h=0,angular.element(i).addClass("show"),angular.element(e).addClass("buttonClicked"),angular.element(document).on("click",c.externalClickListener),angular.element(document).on("keydown",c.keyboardListener),c.getFormElements(),c.tabIndex=0;var f=angular.element(d[0].querySelector(".helperContainer"))[0];if("undefined"!=typeof f){for(var j=0;j<f.getElementsByTagName("BUTTON").length;j++)g[j]=f.getElementsByTagName("BUTTON")[j];h=g.length+f.getElementsByTagName("INPUT").length}d[0].querySelector(".inputFilter")?(d[0].querySelector(".inputFilter").focus(),c.tabIndex=c.tabIndex+h-2,angular.element(d).children()[0].blur()):c.isDisabled||(c.tabIndex=c.tabIndex+h,c.inputModel.length>0&&(l[c.tabIndex].focus(),c.setFocusStyle(c.tabIndex),angular.element(d).children()[0].blur())),c.onOpen()}},c.externalClickListener=function(a){for(var e=d.find(a.target.tagName),f=0;f<e.length;f++)if(a.target==e[f])return;angular.element(i.previousSibling).removeClass("buttonClicked"),angular.element(i).removeClass("show"),angular.element(document).off("click",c.externalClickListener),angular.element(document).off("keydown",c.keyboardListener),b(function(){c.onClose()},0),d.children().children()[0].focus()},c.select=function(a,b){var d=g.indexOf(b.target);switch(c.tabIndex=d,a.toUpperCase()){case"ALL":angular.forEach(c.filteredModel,function(a,b){"undefined"!=typeof a&&a[e.disableProperty]!==!0&&"undefined"==typeof a[e.groupProperty]&&(a[c.tickProperty]=!0)}),c.refreshOutputModel(),c.refreshButton(),c.onSelectAll();break;case"NONE":angular.forEach(c.filteredModel,function(a,b){"undefined"!=typeof a&&a[e.disableProperty]!==!0&&"undefined"==typeof a[e.groupProperty]&&(a[c.tickProperty]=!1)}),c.refreshOutputModel(),c.refreshButton(),c.onSelectNone();break;case"RESET":angular.forEach(c.filteredModel,function(a,b){if("undefined"==typeof a[e.groupProperty]&&"undefined"!=typeof a&&a[e.disableProperty]!==!0){var d=a[c.indexProperty];a[c.tickProperty]=c.backUp[d][c.tickProperty]}}),c.refreshOutputModel(),c.refreshButton(),c.onReset();break;case"CLEAR":c.tabIndex=c.tabIndex+1,c.onClear();break;case"FILTER":c.tabIndex=g.length-1}},c.prepareGrouping=function(){var a=0;angular.forEach(c.filteredModel,function(b,d){b[c.spacingProperty]=a,b[e.groupProperty]===!0?a+=2:b[e.groupProperty]===!1&&(a-=2)})},c.prepareIndex=function(){var a=0;angular.forEach(c.filteredModel,function(b,d){b[c.indexProperty]=a,a++})},c.keyboardListener=function(a){var b=a.keyCode?a.keyCode:a.which,d=!1;if(27===b)a.preventDefault(),a.stopPropagation(),c.toggleCheckboxes(a);else if(40===b||39===b||!a.shiftKey&&9==b)for(d=!0,f=c.tabIndex,c.tabIndex++,c.tabIndex>l.length-1&&(c.tabIndex=0,f=l.length-1);l[c.tabIndex].disabled===!0&&(c.tabIndex++,c.tabIndex>l.length-1&&(c.tabIndex=0),c.tabIndex!==f););else if(38===b||37===b||a.shiftKey&&9==b)for(d=!0,f=c.tabIndex,c.tabIndex--,c.tabIndex<0&&(c.tabIndex=l.length-1,f=0);l[c.tabIndex].disabled===!0&&(c.tabIndex--,c.tabIndex!==f);)c.tabIndex<0&&(c.tabIndex=l.length-1);if(d===!0){a.preventDefault(),l[c.tabIndex].focus();var e=document.activeElement;"CHECKBOX"===e.type.toUpperCase()?(c.setFocusStyle(c.tabIndex),c.removeFocusStyle(f)):(c.removeFocusStyle(f),c.removeFocusStyle(h),c.removeFocusStyle(l.length-1))}d=!1},c.setFocusStyle=function(a){angular.element(l[a]).parent().parent().parent().addClass("multiSelectFocus")},c.removeFocusStyle=function(a){angular.element(l[a]).parent().parent().parent().removeClass("multiSelectFocus")},c.groupProperty=e.groupProperty,c.tickProperty=e.tickProperty,c.directiveId=e.directiveId;var p=o(5);if(c.indexProperty="idx_"+p,c.spacingProperty="spc_"+p,"undefined"!=typeof e.orientation&&("HORIZONTAL"===e.orientation.toUpperCase()?(c.orientationH=!0,c.orientationV=!1):(c.orientationH=!1,c.orientationV=!0)),i=d.children().children().next()[0],"undefined"!=typeof e.maxHeight){var q=d.children().children().children()[0];angular.element(q).attr("style","height:"+e.maxHeight+"; overflow-y:scroll;")}for(var r in c.helperStatus)c.helperStatus.hasOwnProperty(r)&&"undefined"!=typeof e.helperElements&&e.helperElements.toUpperCase().indexOf(r.toUpperCase())===-1&&(c.helperStatus[r]=!1);"undefined"!=typeof e.selectionMode&&"SINGLE"===e.selectionMode.toUpperCase()&&(c.helperStatus.all=!1,c.helperStatus.none=!1),c.icon={},c.icon.selectAll="&#10003;",c.icon.selectNone="&times;",c.icon.reset="&#8630;",c.icon.tickMark="&#10003;","undefined"!=typeof e.translation?(c.lang.selectAll=a.trustAsHtml(c.icon.selectAll+"&nbsp;&nbsp;"+c.translation.selectAll),c.lang.selectNone=a.trustAsHtml(c.icon.selectNone+"&nbsp;&nbsp;"+c.translation.selectNone),c.lang.reset=a.trustAsHtml(c.icon.reset+"&nbsp;&nbsp;"+c.translation.reset),c.lang.search=c.translation.search,c.lang.nothingSelected=a.trustAsHtml(c.translation.nothingSelected)):(c.lang.selectAll=a.trustAsHtml(c.icon.selectAll+"&nbsp;&nbsp;Select All"),c.lang.selectNone=a.trustAsHtml(c.icon.selectNone+"&nbsp;&nbsp;Select None"),c.lang.reset=a.trustAsHtml(c.icon.reset+"&nbsp;&nbsp;Reset"),c.lang.search="Search...",c.lang.nothingSelected="None Selected"),c.icon.tickMark=a.trustAsHtml(c.icon.tickMark),"undefined"!=typeof e.MinSearchLength&&parseInt(e.MinSearchLength)>0&&(m=Math.floor(parseInt(e.MinSearchLength))),c.$watch("inputModel",function(a){a&&(c.refreshOutputModel(),c.refreshButton())},!0),c.$watch("inputModel",function(a){a&&(c.backUp=angular.copy(c.inputModel),c.updateFilter(),c.prepareGrouping(),c.prepareIndex(),c.refreshOutputModel(),c.refreshButton())}),c.$watch("isDisabled",function(a){c.isDisabled=a});var s=function(a){c.$apply(function(){c.scrolled=!1})};angular.element(document).bind("touchstart",s);var t=function(a){c.$apply(function(){c.scrolled=!0})};angular.element(document).bind("touchmove",t),c.$on("$destroy",function(){angular.element(document).unbind("touchstart",s),angular.element(document).unbind("touchmove",t)})}}}]).run(["$templateCache",function(a){var b='<span class="multiSelect inlineBlock"><button id="{{directiveId}}" class="text-left" style="width:100%" type="button"ng-click="toggleCheckboxes( $event ); refreshSelectedItems(); refreshButton(); prepareGrouping; prepareIndex();"ng-bind-html="varButtonLabel"ng-disabled="disable-button"></button><div class="checkboxLayer"><div class="helperContainer" ng-if="helperStatus.filter || helperStatus.all || helperStatus.none || helperStatus.reset "><div class="line" ng-if="helperStatus.all || helperStatus.none || helperStatus.reset "><button type="button" class="helperButton"ng-disabled="isDisabled"ng-if="helperStatus.all"ng-click="select( \'all\', $event );"ng-bind-html="lang.selectAll"></button><button type="button" class="helperButton"ng-disabled="isDisabled"ng-if="helperStatus.none"ng-click="select( \'none\', $event );"ng-bind-html="lang.selectNone"></button><button type="button" class="helperButton reset"ng-disabled="isDisabled"ng-if="helperStatus.reset"ng-click="select( \'reset\', $event );"ng-bind-html="lang.reset"></button></div><div class="line" style="position:relative" ng-if="helperStatus.filter"><input placeholder="{{lang.search}}" type="text"ng-click="select( \'filter\', $event )" ng-model="inputLabel.labelFilter" ng-change="searchChanged()" class="inputFilter"/><button type="button" class="clearButton" ng-click="clearClicked( $event )" >×</button> </div> </div> <div class="checkBoxContainer"><div ng-repeat="item in filteredModel | filter:removeGroupEndMarker" class="multiSelectItem"ng-class="{selected: item[ tickProperty ], horizontal: orientationH, vertical: orientationV, multiSelectGroup:item[ groupProperty ], disabled:itemIsDisabled( item )}"ng-click="syncItems( item, $event, $index );" ng-mouseleave="removeFocusStyle( tabIndex );"> <div class="acol" ng-if="item[ spacingProperty ] > 0" ng-repeat="i in numberToArray( item[ spacingProperty ] ) track by $index"></div>  <div class="acol"><label><input class="checkbox focusable" type="checkbox" ng-disabled="itemIsDisabled( item )" ng-checked="item[ tickProperty ]" ng-click="syncItems( item, $event, $index )" /><span ng-class="{disabled:itemIsDisabled( item )}" ng-bind-html="writeLabel( item, \'itemLabel\' )"></span></label></div><span class="tickMark" ng-if="item[ groupProperty ] !== true && item[ tickProperty ] === true" ng-bind-html="icon.tickMark"></span></div></div></div></span>';a.put("root-multi-select.htm",b)}]);
